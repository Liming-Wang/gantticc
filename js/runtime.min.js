function task_form_delete(){gchart.sendMessage("update_task",{tid:$("#title_tid").val(),"delete":"true"}),$("#task_form").hide(),gantticc.project.deleteTask($("#title_tid").val())}function task_form_cancel(){gchart.sendMessage("update_task",{tid:$("#title_tid").val(),cancel:"true"}),$("#task_form").hide(),$("#title_txtfield").trigger("blur"),$("#notes_txtfield").trigger("blur")}function task_form_submit(){var t=gantticc.project.getTask($("#title_tid").val());null!=t&&(t.title=$("#title_txtfield").val(),t.title.length<1&&(t.title=$("#title_txtfield").attr("placeholder")),t.color=$("#task_color").val(),t.notes=$("#notes_txtfield").val(),gchart.sendMessage("update_task",{tid:t.tid,title:t.title,color:t.color,notes:t.notes}),$("#task_form").hide(),gantticc.project.saveTasks())}function task_form_set_color(t){for(var e=0;e<gantticc.colors.length;e++){var a=gantticc.colors[e];$("#task_color_"+a).removeClass("swatch_sel")}$("#task_color_"+t).addClass("swatch_sel"),$("#task_color").val(t)}function project_update(t){var e=new Date($("#project_startdate").val()).toISOString(),a=new Date($("#project_enddate").val()).toISOString(),n=$("#mtab").attr("value")?new Date($("#mtab").attr("value")):new Date;n<new Date(gantticc.project.start)?n=new Date(gantticc.project.start):n>new Date(gantticc.project.end)&&(n=new Date(gantticc.project.end)),gchart.sendMessage("update_project",{start_date:e,end_date:a,scroll_date:n}),gantticc.project.title=$("#project_title_txtfield").val(),gantticc.project.title.length<1&&(gantticc.project.title=$("#project_title_txtfield").attr("placeholder")),gantticc.project.start=e,gantticc.project.end=a,t||(gantticc.project.save(),gantticc.project.saveTasks()),gantticc.updateCurrentMonthBtn(n),gantticc.updateJumpMonthMenu(),gantticc.updateProjectList()}function project_delete_cur(){gantticc.deleteCurrentProject(),gantticc.applyCurrentProject(),gchart.sendMessage("init_tasks",{tasks:gantticc.project.tasks})}function project_new(){return null==gantticc.addNewProject()?void alert("Cannot create more than "+gantticc.maxProjCount+" projects."):(gantticc.applyCurrentProject(),gchart.sendMessage("init_tasks",{tasks:gantticc.project.tasks}),$("#settings").is(":hidden")&&($("#settings_toggler").removeClass("icon-arrow-down").addClass("icon-arrow-up"),$("#settings").slideDown()),void $("#project_title_txtfield").attr("placeholder",$("#project_title_txtfield").val()).val("").focus().bind("keypress.newprj",function(t){13==t.keyCode&&(project_update(),$("#project_title_txtfield").unbind("keypress.newprj").blur())}).bind("blur.newprj",function(){$("#project_title_txtfield").unbind("keypress.newprj"),$("#project_title_txtfield").unbind("blur.newprj")}))}function project_load(t){gantticc.setCurrentProject(t);var e=gantticc.project.getTasksOnDate(new Date);e.length>0&&gchart.sendMessage("scroll_to_task",{task:e[0]}),gchart.sendMessage("init_tasks",{tasks:gantticc.project.tasks})}function gchart_jump(t){var e=new Date($("#mtab").attr("value")),a=e.getFullYear(),n=e.getMonth();"left"===t?(n--,0>n&&(a--,n=11)):"right"===t&&(n++,12==n&&(a++,n=0));var c=new Date(a,n,1),r=new Date(gantticc.project.start),s=new Date(gantticc.project.end);if(gantticc.heatmap.start){var i=new Date(gantticc.heatmap.start),o=new Date(gantticc.heatmap.end);r>i&&(r=i),o>s&&(s=o)}c>s||(r>c&&(c=r),gchart_scroll(c),gantticc.updateCurrentMonthBtn(c))}function gchart_scroll(t){gchart.sendMessage("scroll_to_date",{date:t.toISOString()}),gantticc.updateCurrentMonthBtn(t),$("#mselects").hide()}function set_scale(t){gantticc.scale=t;var e=gantticc.project.start,a=gantticc.project.end;return gantticc.heatmap.start?void project_heatmap(t,1):void gchart.sendMessage("set_scale",{unit:t,start_date:e,end_date:a})}function toggle_swatch_color(t){if(!gantticc.heatmap.start){var e=$(".swatch_"+t).next().first();e.toggleClass("swatch_checked");var a=!1;e.hasClass("swatch_checked")&&(a=!0),gchart.sendMessage("set_swatch",{color:t,status:a})}}function toggle_settings(){$("#settings").is(":hidden")?($("#settings_toggler").removeClass("icon-arrow-down").addClass("icon-arrow-up"),$("#settings").slideDown()):($("#settings_toggler").addClass("icon-arrow-down").removeClass("icon-arrow-up"),$("#settings").slideUp())}function project_heatmap(t,e){if(!e){if("on"===$("#heatmap_status").attr("value")){gantticc.resetHeatmap();var a=new Date($("#mtab").attr("value"));return a<new Date(gantticc.project.start)&&(a=new Date(gantticc.project.start)),gchart.sendMessage("update_project",{start_date:gantticc.project.start,end_date:gantticc.project.end,scroll_date:a}),gchart.sendMessage("init_tasks",{tasks:gantticc.project.tasks,no_scroll:!0}),gantticc.resetSwatch(),gantticc.updateJumpMonthMenu(),gantticc.updateCurrentMonthBtn(a),void(gantticc.heatmap={})}$("#heatmap_status").html("<b>Heat Map</b>").attr("value","on")}t||(t=gantticc.scale);for(var n=new Date(gantticc.project.start).getTime(),c=new Date(gantticc.project.end).getTime(),r=0;r<gantticc.projects.length;r++){var s=gantticc.projects[r],i=new Date(s.start).getTime(),o=new Date(s.end).getTime();n>i&&(n=i),o>c&&(c=o)}var g=[],l=[],d=0,p=864e5;"week"===t&&(p=7*p);for(var u=n;c>=u;u+=p){var _,h=new Date(u);if(!h.dst()){var w=h.getTime();h=new Date(w+36e5)}_="day"===t?gantticc.getAllTasksOnDate(h):gantticc.getAllTasksInWeek(h.getWeekNumber(h));var f={date:u,tasks:_};d<_.length&&(d=_.length),l.push(f)}d++;for(var m=[],r=0;r<gantticc.projects.length;r++){var s=gantticc.projects[r],f={title:s.title,data:s.getDataForHeatMap(t)};m.push(f)}g=[{title:"Total",data:l}],$.merge(g,m),gchart.sendMessage("init_heatmap",{start_date:new Date(n).toISOString(),end_date:new Date(c).toISOString(),unit:t,data:g,min:0,max:d}),gantticc.heatmap={start:new Date(n).toISOString(),end:new Date(c).toISOString()},gantticc.updateJumpMonthMenu(gantticc.heatmap.start,gantticc.heatmap.end)}function gchart_print(){$("svg[data-bs-id]").attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink");var t,e,a=$("#gantt").children().first().html();t=a.indexOf("viewBox="),t+=9,e=a.indexOf("xmlns="),e-=2;var n=a.substr(t,e-t),c=new Date($("#mtab").attr("value")).getTime(),r=new Date(gantticc.project.start).getTime(),s=30*Math.floor((c-r)/1e3/3600/24),i=s+" -0.5 "+gantticc.getHeight()+" "+gantticc.getWidth();a=a.replace(n,i),$("#printwrap").html(a),window.print()}require.config({paths:{firebase:"https://cdn.firebase.com/js/client/1.0.11/firebase"},urlArgs:"bust=b20150307",waitSeconds:10}),require(["jquery","firebase","bootstrap.min","bootstrap-datepicker.min","bonsai.min","gantticc.min"],function(){gantticc.initUI(),gantticc.init()},function(){var t=document.getElementById("gantt");t.innerHTML="Error occurred while loading required scripts, please try again later."}),Date.prototype.stdTimezoneOffset=function(){var t=new Date(this.getFullYear(),0,1),e=new Date(this.getFullYear(),6,1);return Math.max(t.getTimezoneOffset(),e.getTimezoneOffset())},Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};