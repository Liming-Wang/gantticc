function gchart_render(){$("#gantt").empty();gchart=bonsai.run(document.getElementById("gantt"),{url:"js/gchart.min.js?bustcache="+Math.random(),width:gantticc.getWidth(),height:gantticc.getHeight(),code:function(){stage.on("message:update_task",function(e){if(e.cancel==="true"){ganttClickLock=0;return}var t=null;var n=0;for(n;n<gantticc.tasks.length;n++){t=gantticc.tasks[n];if(t.tid==e.tid)break}if(t==null)return;if(e.delete==="true"){gchart.deleteTaskAnim(t.group_asset);gantticc.tasks.splice(n,1)}else{e.title=e.title;t.title_asset.attr("text",e.title);t.updateIndicatorIcon(e.notes);t.updateTaskColor(e.color)}ganttClickLock=0});stage.on("message:update_project",function(e){if(typeof e.start_date!="undefined"){var t=new Date;if(e.scroll_date){t=new Date(e.scroll_date)}gchart.drawHeader(e.start_date,e.end_date);gchart.scrollToDate(t);gchart.updateCurrentUnit()}});stage.on("message:init_tasks",function(e){gchart.initTasks(e.tasks)});stage.on("message:init_heatmap",function(e){var t=gchart.getScrollDate();if(gchart.unit!==e.unit){gchart.unit=e.unit}gchart.drawHeader(e.start_date,e.end_date);gchart.updateCurrentUnit(1);gchart.initHeatMap({min:e.min,max:e.max,projects:e.data});gchart.scrollToDate(t);stage.sendMessage("scroll_date",{date:t})});stage.on("message:scroll_to_date",function(e){var t=new Date(e.date);gchart.scrollToDate(t,1)});stage.on("message:set_swatch",function(e){gchart.highlightTaskByColor(e.color,e.status)});stage.on("message:set_scale",function(e){var t=new Date;if(gchart.unit===e.unit){gchart.scrollToDate(t)}else{t=gchart.getScrollDate();gchart.unit=e.unit;gchart.drawHeader(e.start_date,e.end_date);gchart.updateCurrentUnit(1);gchart.scrollToDate(t,1)}stage.sendMessage("scroll_date",{date:t})});stage.sendMessage("ready",{})}});gchart.on("load",function(e){gchart.on("message:ready",function(e){if(gantticc.authenticated===false){if(gantticc.youShallNotPass()===false){gchart.destroy();return}}var t=(new Date($("#project_startdate").val())).toISOString();var n=(new Date($("#project_enddate").val())).toISOString();var r=$("#mtab").attr("value")?new Date($("#mtab").attr("value")):new Date;gchart.sendMessage("update_project",{start_date:t,end_date:n,scroll_date:r});gchart.sendMessage("init_tasks",{tasks:gantticc.project.tasks});if(!gantticc.loaded){gantticc.showIntro()}gantticc.loaded=true});gchart.on("message:edit_task",function(e){var t=gantticc.project.getTask(e.tid);if(t==null)return;$("#title_tid").val(t.tid);if(t.title==="New Task"){$("#title_txtfield").val("");$("#title_txtfield").attr("placeholder","New Task")}else{$("#title_txtfield").val(t.title);$("#title_txtfield").attr("placeholder","")}if(!t.color)t.color="gray";$("#task_color").val(t.color);for(var n=0;n<gantticc.colors.length;n++){var r=gantticc.colors[n];$("#task_color_"+r).removeClass("swatch_sel")}$("#task_color_"+t.color).addClass("swatch_sel");$("#notes_txtfield").val(t.notes);var i=e.y+$("#topbar").height();if(!$("#settings").is(":hidden"))i+=$("#settings").height();$("#task_form").css({top:i,left:e.x});$("#task_form").show()});gchart.on("message:update_task",function(e){var t=gantticc.project.getTask(e.tid);if(t==null)return;if(e.start)t.start=e.start;if(e.end)t.end=e.end;if(e.row)t.row=e.row;gantticc.project.saveTasks()});gchart.on("message:new_task",function(e){gantticc.project.addTask(e.task)});gchart.on("message:scroll_date",function(e){var t=new Date(e.date);gantticc.updateCurrentMonthBtn(t)});gchart.on("message:update_heatmap",function(e){project_heatmap(e.unit)})});gantticc.applyCurrentProject()}function task_form_delete(){gchart.sendMessage("update_task",{tid:$("#title_tid").val(),"delete":"true"});$("#task_form").hide();gantticc.project.deleteTask($("#title_tid").val())}function task_form_cancel(){gchart.sendMessage("update_task",{tid:$("#title_tid").val(),cancel:"true"});$("#task_form").hide();$("#title_txtfield").trigger("blur");$("#notes_txtfield").trigger("blur")}function task_form_submit(){var e=gantticc.project.getTask($("#title_tid").val());if(e==null)return;e.title=$("#title_txtfield").val();e.color=$("#task_color").val();e.notes=$("#notes_txtfield").val();gchart.sendMessage("update_task",{tid:e.tid,title:e.title,color:e.color,notes:e.notes});$("#task_form").hide();gantticc.project.saveTasks()}function task_form_set_color(e){for(var t=0;t<gantticc.colors.length;t++){var n=gantticc.colors[t];$("#task_color_"+n).removeClass("swatch_sel")}$("#task_color_"+e).addClass("swatch_sel");$("#task_color").val(e)}function project_update(e){var t=(new Date($("#project_startdate").val())).toISOString();var n=(new Date($("#project_enddate").val())).toISOString();var r=$("#mtab").attr("value")?new Date($("#mtab").attr("value")):new Date;if(r<new Date(gantticc.project.start)){r=new Date(gantticc.project.start)}else if(r>new Date(gantticc.project.end)){r=new Date(gantticc.project.end)}gchart.sendMessage("update_project",{start_date:t,end_date:n,scroll_date:r});gantticc.project.title=$("#project_title_txtfield").val();gantticc.project.start=t;gantticc.project.end=n;if(!e){gantticc.project.save();gantticc.project.saveTasks()}gantticc.updateCurrentMonthBtn(r);gantticc.updateJumpMonthMenu();gantticc.updateProjectList()}function project_delete_cur(){gantticc.deleteCurrentProject();gantticc.applyCurrentProject();gchart.sendMessage("init_tasks",{tasks:gantticc.project.tasks})}function project_new(){if(gantticc.addNewProject()==null){alert("Cannot create more than "+gantticc.maxProjCount+" projects.");return}gantticc.applyCurrentProject();gchart.sendMessage("init_tasks",{tasks:gantticc.project.tasks})}function project_load(e){gantticc.setCurrentProject(e);gchart.sendMessage("init_tasks",{tasks:gantticc.project.tasks});gantticc.resetHeatmap();gantticc.resetSwatch()}function gchart_jump(e){var t=new Date($("#mtab").attr("value"));var n=t.getFullYear();var r=t.getMonth();var i=1;if(e==="left"){r--;if(r<0){n--;r=11}}else if(e==="right"){r++;if(r==12){n++;r=0}}var s=new Date(n,r,1);var o=new Date(gantticc.project.start);var u=new Date(gantticc.project.end);if(gantticc.heatmap.start){var a=new Date(gantticc.heatmap.start);var f=new Date(gantticc.heatmap.end);if(o>a)o=a;if(u<f)u=f}if(s>u)return;if(s<o){s=o}gchart_scroll(s);gantticc.updateCurrentMonthBtn(s)}function gchart_scroll(e){gchart.sendMessage("scroll_to_date",{date:e.toISOString()});gantticc.updateCurrentMonthBtn(e);$("#mselects").hide()}function set_scale(e){var t=gantticc.project.start;var n=gantticc.project.end;if(gantticc.heatmap.start){project_heatmap(e,1);return}gchart.sendMessage("set_scale",{unit:e,start_date:t,end_date:n})}function toggle_swatch_color(e){if(gantticc.heatmap.start)return;var t=$(".swatch_"+e).next().first();t.toggleClass("swatch_checked");var n=false;if(t.hasClass("swatch_checked")){n=true}gchart.sendMessage("set_swatch",{color:e,status:n})}function toggle_settings(){if($("#settings").is(":hidden")){$("#settings_toggler").removeClass("icon-arrow-down").addClass("icon-arrow-up");$("#settings").slideDown()}else{$("#settings_toggler").addClass("icon-arrow-down").removeClass("icon-arrow-up");$("#settings").slideUp()}}function project_heatmap(e,t){if(!t){if($("#heatmap_status").attr("value")==="on"){gantticc.resetHeatmap();var n=new Date($("#mtab").attr("value"));if(n<new Date(gantticc.project.start)){n=new Date(gantticc.project.start)}gchart.sendMessage("update_project",{start_date:gantticc.project.start,end_date:gantticc.project.end,scroll_date:n});gchart.sendMessage("init_tasks",{tasks:gantticc.project.tasks,no_scroll:true});gantticc.resetSwatch();gantticc.updateJumpMonthMenu();gantticc.updateCurrentMonthBtn(n);gantticc.heatmap={};return}else{$("#heatmap_status").html("<b>Heat Map</b>").attr("value","on")}}if(!e)e="day";var r=(new Date(gantticc.project.start)).getTime();var i=(new Date(gantticc.project.end)).getTime();for(var s=0;s<gantticc.projects.length;s++){var o=gantticc.projects[s];var u=(new Date(o.start)).getTime();var a=(new Date(o.end)).getTime();if(r>u)r=u;if(i<a)i=a}var f=[],l=[],c=0,h=1e3*3600*24;if(e==="week")h=h*7;for(var p=r;p<=i;p+=h){var d;var v=new Date(p);if(e==="day"){d=gantticc.getAllTasksOnDate(v)}else{d=gantticc.getAllTasksInWeek(v.getWeekNumber(v))}var m={date:p,tasks:d};if(c<d.length)c=d.length;l.push(m)}c++;var g=[];for(var s=0;s<gantticc.projects.length;s++){var o=gantticc.projects[s];var m={title:o.title,data:o.getDataForHeatMap(e)};g.push(m)}f=[{title:"Total",data:l}];$.merge(f,g);gchart.sendMessage("init_heatmap",{start_date:(new Date(r)).toISOString(),end_date:(new Date(i)).toISOString(),unit:e,data:f,min:0,max:c});gantticc.heatmap={start:(new Date(r)).toISOString(),end:(new Date(i)).toISOString()};gantticc.updateJumpMonthMenu(gantticc.heatmap.start,gantticc.heatmap.end)}require.config({paths:{firebase:"https://cdn.firebase.com/v0/firebase"},waitSeconds:10});require(["jquery","firebase","bootstrap.min","bootstrap-datepicker.min","gantticc.min","bonsai.min"],function(e){gantticc.initUI();gantticc.init()},function(e){var t=document.getElementById("gantt");t.innerHTML="Error occurred while loading required scripts, please try again later."});var gchart